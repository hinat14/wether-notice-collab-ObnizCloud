<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <script src="https://obniz.io/js/jquery-3.2.1.min.js"></script>
    <script
      src="https://unpkg.com/obniz@3.x/obniz.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <script>
      const obniz = new Obniz("OBNIZ_ID_HERE");
      obniz.onconnect = async function() {
      let tempsens = obniz.wired("MCP9701", { gnd: 0, output: 1, vcc: 2 });
      let temp = await tempsens.getWait();
      if (temp >= 20) {
        temp = Math.floor(temp * 10) / 10;
        sendToSlack(temp);
      }

      function sendToSlack(temp) {
        let url = "https://hooks.slack.com/services/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";
        let data = {
          text: "東大医学はｱﾀﾏﾜﾙｲｯ" + "! ^" + temp
        };

        let dataJson = JSON.stringify(data);

        $.ajax({
          type: "POST",
          dataType: "json",
          url: url,
          processData: false,
          data: "payload=" + dataJson
        }).then(
          function(data) {},
          function(XMLHttpRequest, textStatus, errorThrown) {
            console.log("post to bot");
          }
          );
      }
    };
    </script>
  </body>
</html>
